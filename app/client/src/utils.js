function isNumeric(str) {
    if (typeof str != "string") return false // we only process strings!  
    return !isNaN(str) && // use type coercion to parse the _entirety_ of the string (`parseFloat` alone does not do this)...
           !isNaN(parseFloat(str)) // ...and ensure strings of whitespace fail
}

const xtermColors = {
    "0": {"hex": "#000000", "name": "Black"},
    "1": {"hex": "#800000", "name": "Maroon"},
    "2": {"hex": "#008000", "name": "Green"},
    "3": {"hex": "#808000", "name": "Olive"},
    "4": {"hex": "#000080", "name": "Navy"},
    "5": {"hex": "#800080", "name": "Purple"},
    "6": {"hex": "#008080", "name": "Teal"},
    "7": {"hex": "#c0c0c0", "name": "Silver"},
    "8": {"hex": "#808080", "name": "Grey"},
    "9": {"hex": "#ff0000", "name": "Red"},
    "10": {"hex": "#00ff00", "name": "Lime"},
    "11": {"hex": "#ffff00", "name": "Yellow"},
    "12": {"hex": "#0000ff", "name": "Blue"},
    "13": {"hex": "#ff00ff", "name": "Fuchsia"},
    "14": {"hex": "#00ffff", "name": "Aqua"},
    "15": {"hex": "#ffffff", "name": "White"},
    //"16": {"hex": "#000000", "name": "Grey0"},
    "17": {"hex": "#00005f", "name": "NavyBlue"},
    "18": {"hex": "#000087", "name": "DarkBlue"},
    "19": {"hex": "#0000af", "name": "Blue3"},
    "20": {"hex": "#0000d7", "name": "Blue3"},
    //"21": {"hex": "#0000ff", "name": "Blue1"},
    "22": {"hex": "#005f00", "name": "DarkGreen"},
    "23": {"hex": "#005f5f", "name": "DeepSkyBlue4"},
    "24": {"hex": "#005f87", "name": "DeepSkyBlue4"},
    "25": {"hex": "#005faf", "name": "DeepSkyBlue4"},
    "26": {"hex": "#005fd7", "name": "DodgerBlue3"},
    "27": {"hex": "#005fff", "name": "DodgerBlue2"},
    "28": {"hex": "#008700", "name": "Green4"},
    "29": {"hex": "#00875f", "name": "SpringGreen4"},
    "30": {"hex": "#008787", "name": "Turquoise4"},
    "31": {"hex": "#0087af", "name": "DeepSkyBlue3"},
    "32": {"hex": "#0087d7", "name": "DeepSkyBlue3"},
    "33": {"hex": "#0087ff", "name": "DodgerBlue1"},
    "34": {"hex": "#00af00", "name": "Green3"},
    "35": {"hex": "#00af5f", "name": "SpringGreen3"},
    "36": {"hex": "#00af87", "name": "DarkCyan"},
    "37": {"hex": "#00afaf", "name": "LightSeaGreen"},
    "38": {"hex": "#00afd7", "name": "DeepSkyBlue2"},
    "39": {"hex": "#00afff", "name": "DeepSkyBlue1"},
    "40": {"hex": "#00d700", "name": "Green3"},
    "41": {"hex": "#00d75f", "name": "SpringGreen3"},
    "42": {"hex": "#00d787", "name": "SpringGreen2"},
    "43": {"hex": "#00d7af", "name": "Cyan3"},
    "44": {"hex": "#00d7d7", "name": "DarkTurquoise"},
    "45": {"hex": "#00d7ff", "name": "Turquoise2"},
    //"46": {"hex": "#00ff00", "name": "Green1"},
    "47": {"hex": "#00ff5f", "name": "SpringGreen2"},
    "48": {"hex": "#00ff87", "name": "SpringGreen1"},
    "49": {"hex": "#00ffaf", "name": "MediumSpringGreen"},
    "50": {"hex": "#00ffd7", "name": "Cyan2"},
    //"51": {"hex": "#00ffff", "name": "Cyan1"},
    "52": {"hex": "#5f0000", "name": "DarkRed"},
    "53": {"hex": "#5f005f", "name": "DeepPink4"},
    "54": {"hex": "#5f0087", "name": "Purple4"},
    "55": {"hex": "#5f00af", "name": "Purple4"},
    "56": {"hex": "#5f00d7", "name": "Purple3"},
    "57": {"hex": "#5f00ff", "name": "BlueViolet"},
    "58": {"hex": "#5f5f00", "name": "Orange4"},
    "59": {"hex": "#5f5f5f", "name": "Grey37"},
    "60": {"hex": "#5f5f87", "name": "MediumPurple4"},
    "61": {"hex": "#5f5faf", "name": "SlateBlue3"},
    "62": {"hex": "#5f5fd7", "name": "SlateBlue3"},
    "63": {"hex": "#5f5fff", "name": "RoyalBlue1"},
    "64": {"hex": "#5f8700", "name": "Chartreuse4"},
    "65": {"hex": "#5f875f", "name": "DarkSeaGreen4"},
    "66": {"hex": "#5f8787", "name": "PaleTurquoise4"},
    "67": {"hex": "#5f87af", "name": "SteelBlue"},
    "68": {"hex": "#5f87d7", "name": "SteelBlue3"},
    "69": {"hex": "#5f87ff", "name": "CornflowerBlue"},
    "70": {"hex": "#5faf00", "name": "Chartreuse3"},
    "71": {"hex": "#5faf5f", "name": "DarkSeaGreen4"},
    "72": {"hex": "#5faf87", "name": "CadetBlue"},
    "73": {"hex": "#5fafaf", "name": "CadetBlue"},
    "74": {"hex": "#5fafd7", "name": "SkyBlue3"},
    "75": {"hex": "#5fafff", "name": "SteelBlue1"},
    "76": {"hex": "#5fd700", "name": "Chartreuse3"},
    "77": {"hex": "#5fd75f", "name": "PaleGreen3"},
    "78": {"hex": "#5fd787", "name": "SeaGreen3"},
    "79": {"hex": "#5fd7af", "name": "Aquamarine3"},
    "80": {"hex": "#5fd7d7", "name": "MediumTurquoise"},
    "81": {"hex": "#5fd7ff", "name": "SteelBlue1"},
    "82": {"hex": "#5fff00", "name": "Chartreuse2"},
    "83": {"hex": "#5fff5f", "name": "SeaGreen2"},
    "84": {"hex": "#5fff87", "name": "SeaGreen1"},
    "85": {"hex": "#5fffaf", "name": "SeaGreen1"},
    "86": {"hex": "#5fffd7", "name": "Aquamarine1"},
    "87": {"hex": "#5fffff", "name": "DarkSlateGray2"},
    "88": {"hex": "#870000", "name": "DarkRed"},
    "89": {"hex": "#87005f", "name": "DeepPink4"},
    "90": {"hex": "#870087", "name": "DarkMagenta"},
    "91": {"hex": "#8700af", "name": "DarkMagenta"},
    "92": {"hex": "#8700d7", "name": "DarkViolet"},
    "93": {"hex": "#8700ff", "name": "Purple"},
    "94": {"hex": "#875f00", "name": "Orange4"},
    "95": {"hex": "#875f5f", "name": "LightPink4"},
    "96": {"hex": "#875f87", "name": "Plum4"},
    "97": {"hex": "#875faf", "name": "MediumPurple3"},
    "98": {"hex": "#875fd7", "name": "MediumPurple3"},
    "99": {"hex": "#875fff", "name": "SlateBlue1"},
    "100": {"hex": "#878700", "name": "Yellow4"},
    "101": {"hex": "#87875f", "name": "Wheat4"},
    "102": {"hex": "#878787", "name": "Grey53"},
    "103": {"hex": "#8787af", "name": "LightSlateGrey"},
    "104": {"hex": "#8787d7", "name": "MediumPurple"},
    "105": {"hex": "#8787ff", "name": "LightSlateBlue"},
    "106": {"hex": "#87af00", "name": "Yellow4"},
    "107": {"hex": "#87af5f", "name": "DarkOliveGreen3"},
    "108": {"hex": "#87af87", "name": "DarkSeaGreen"},
    "109": {"hex": "#87afaf", "name": "LightSkyBlue3"},
    "110": {"hex": "#87afd7", "name": "LightSkyBlue3"},
    "111": {"hex": "#87afff", "name": "SkyBlue2"},
    "112": {"hex": "#87d700", "name": "Chartreuse2"},
    "113": {"hex": "#87d75f", "name": "DarkOliveGreen3"},
    "114": {"hex": "#87d787", "name": "PaleGreen3"},
    "115": {"hex": "#87d7af", "name": "DarkSeaGreen3"},
    "116": {"hex": "#87d7d7", "name": "DarkSlateGray3"},
    "117": {"hex": "#87d7ff", "name": "SkyBlue1"},
    "118": {"hex": "#87ff00", "name": "Chartreuse1"},
    "119": {"hex": "#87ff5f", "name": "LightGreen"},
    "120": {"hex": "#87ff87", "name": "LightGreen"},
    "121": {"hex": "#87ffaf", "name": "PaleGreen1"},
    "122": {"hex": "#87ffd7", "name": "Aquamarine1"},
    "123": {"hex": "#87ffff", "name": "DarkSlateGray1"},
    "124": {"hex": "#af0000", "name": "Red3"},
    "125": {"hex": "#af005f", "name": "DeepPink4"},
    "126": {"hex": "#af0087", "name": "MediumVioletRed"},
    "127": {"hex": "#af00af", "name": "Magenta3"},
    "128": {"hex": "#af00d7", "name": "DarkViolet"},
    "129": {"hex": "#af00ff", "name": "Purple"},
    "130": {"hex": "#af5f00", "name": "DarkOrange3"},
    "131": {"hex": "#af5f5f", "name": "IndianRed"},
    "132": {"hex": "#af5f87", "name": "HotPink3"},
    "133": {"hex": "#af5faf", "name": "MediumOrchid3"},
    "134": {"hex": "#af5fd7", "name": "MediumOrchid"},
    "135": {"hex": "#af5fff", "name": "MediumPurple2"},
    "136": {"hex": "#af8700", "name": "DarkGoldenrod"},
    "137": {"hex": "#af875f", "name": "LightSalmon3"},
    "138": {"hex": "#af8787", "name": "RosyBrown"},
    "139": {"hex": "#af87af", "name": "Grey63"},
    "140": {"hex": "#af87d7", "name": "MediumPurple2"},
    "141": {"hex": "#af87ff", "name": "MediumPurple1"},
    "142": {"hex": "#afaf00", "name": "Gold3"},
    "143": {"hex": "#afaf5f", "name": "DarkKhaki"},
    "144": {"hex": "#afaf87", "name": "NavajoWhite3"},
    "145": {"hex": "#afafaf", "name": "Grey69"},
    "146": {"hex": "#afafd7", "name": "LightSteelBlue3"},
    "147": {"hex": "#afafff", "name": "LightSteelBlue"},
    "148": {"hex": "#afd700", "name": "Yellow3"},
    "149": {"hex": "#afd75f", "name": "DarkOliveGreen3"},
    "150": {"hex": "#afd787", "name": "DarkSeaGreen3"},
    "151": {"hex": "#afd7af", "name": "DarkSeaGreen2"},
    "152": {"hex": "#afd7d7", "name": "LightCyan3"},
    "153": {"hex": "#afd7ff", "name": "LightSkyBlue1"},
    "154": {"hex": "#afff00", "name": "GreenYellow"},
    "155": {"hex": "#afff5f", "name": "DarkOliveGreen2"},
    "156": {"hex": "#afff87", "name": "PaleGreen1"},
    "157": {"hex": "#afffaf", "name": "DarkSeaGreen2"},
    "158": {"hex": "#afffd7", "name": "DarkSeaGreen1"},
    "159": {"hex": "#afffff", "name": "PaleTurquoise1"},
    "160": {"hex": "#d70000", "name": "Red3"},
    "161": {"hex": "#d7005f", "name": "DeepPink3"},
    "162": {"hex": "#d70087", "name": "DeepPink3"},
    "163": {"hex": "#d700af", "name": "Magenta3"},
    "164": {"hex": "#d700d7", "name": "Magenta3"},
    "165": {"hex": "#d700ff", "name": "Magenta2"},
    "166": {"hex": "#d75f00", "name": "DarkOrange3"},
    "167": {"hex": "#d75f5f", "name": "IndianRed"},
    "168": {"hex": "#d75f87", "name": "HotPink3"},
    "169": {"hex": "#d75faf", "name": "HotPink2"},
    "170": {"hex": "#d75fd7", "name": "Orchid"},
    "171": {"hex": "#d75fff", "name": "MediumOrchid1"},
    "172": {"hex": "#d78700", "name": "Orange3"},
    "173": {"hex": "#d7875f", "name": "LightSalmon3"},
    "174": {"hex": "#d78787", "name": "LightPink3"},
    "175": {"hex": "#d787af", "name": "Pink3"},
    "176": {"hex": "#d787d7", "name": "Plum3"},
    "177": {"hex": "#d787ff", "name": "Violet"},
    "178": {"hex": "#d7af00", "name": "Gold3"},
    "179": {"hex": "#d7af5f", "name": "LightGoldenrod3"},
    "180": {"hex": "#d7af87", "name": "Tan"},
    "181": {"hex": "#d7afaf", "name": "MistyRose3"},
    "182": {"hex": "#d7afd7", "name": "Thistle3"},
    "183": {"hex": "#d7afff", "name": "Plum2"},
    "184": {"hex": "#d7d700", "name": "Yellow3"},
    "185": {"hex": "#d7d75f", "name": "Khaki3"},
    "186": {"hex": "#d7d787", "name": "LightGoldenrod2"},
    "187": {"hex": "#d7d7af", "name": "LightYellow3"},
    "188": {"hex": "#d7d7d7", "name": "Grey84"},
    "189": {"hex": "#d7d7ff", "name": "LightSteelBlue1"},
    "190": {"hex": "#d7ff00", "name": "Yellow2"},
    "191": {"hex": "#d7ff5f", "name": "DarkOliveGreen1"},
    "192": {"hex": "#d7ff87", "name": "DarkOliveGreen1"},
    "193": {"hex": "#d7ffaf", "name": "DarkSeaGreen1"},
    "194": {"hex": "#d7ffd7", "name": "Honeydew2"},
    "195": {"hex": "#d7ffff", "name": "LightCyan1"},
    //"196": {"hex": "#ff0000", "name": "Red1"},
    "197": {"hex": "#ff005f", "name": "DeepPink2"},
    "198": {"hex": "#ff0087", "name": "DeepPink1"},
    "199": {"hex": "#ff00af", "name": "DeepPink1"},
    "200": {"hex": "#ff00d7", "name": "Magenta2"},
    //"201": {"hex": "#ff00ff", "name": "Magenta1"},
    "202": {"hex": "#ff5f00", "name": "OrangeRed1"},
    "203": {"hex": "#ff5f5f", "name": "IndianRed1"},
    "204": {"hex": "#ff5f87", "name": "IndianRed1"},
    "205": {"hex": "#ff5faf", "name": "HotPink"},
    "206": {"hex": "#ff5fd7", "name": "HotPink"},
    "207": {"hex": "#ff5fff", "name": "MediumOrchid1"},
    "208": {"hex": "#ff8700", "name": "DarkOrange"},
    "209": {"hex": "#ff875f", "name": "Salmon1"},
    "210": {"hex": "#ff8787", "name": "LightCoral"},
    "211": {"hex": "#ff87af", "name": "PaleVioletRed1"},
    "212": {"hex": "#ff87d7", "name": "Orchid2"},
    "213": {"hex": "#ff87ff", "name": "Orchid1"},
    "214": {"hex": "#ffaf00", "name": "Orange1"},
    "215": {"hex": "#ffaf5f", "name": "SandyBrown"},
    "216": {"hex": "#ffaf87", "name": "LightSalmon1"},
    "217": {"hex": "#ffafaf", "name": "LightPink1"},
    "218": {"hex": "#ffafd7", "name": "Pink1"},
    "219": {"hex": "#ffafff", "name": "Plum1"},
    "220": {"hex": "#ffd700", "name": "Gold1"},
    "221": {"hex": "#ffd75f", "name": "LightGoldenrod2"},
    "222": {"hex": "#ffd787", "name": "LightGoldenrod2"},
    "223": {"hex": "#ffd7af", "name": "NavajoWhite1"},
    "224": {"hex": "#ffd7d7", "name": "MistyRose1"},
    "225": {"hex": "#ffd7ff", "name": "Thistle1"},
    //"226": {"hex": "#ffff00", "name": "Yellow1"},
    "227": {"hex": "#ffff5f", "name": "LightGoldenrod1"},
    "228": {"hex": "#ffff87", "name": "Khaki1"},
    "229": {"hex": "#ffffaf", "name": "Wheat1"},
    "230": {"hex": "#ffffd7", "name": "Cornsilk1"},
    //"231": {"hex": "#ffffff", "name": "Grey100"},
    "232": {"hex": "#080808", "name": "Grey3"},
    "233": {"hex": "#121212", "name": "Grey7"},
    "234": {"hex": "#1c1c1c", "name": "Grey11"},
    "235": {"hex": "#262626", "name": "Grey15"},
    "236": {"hex": "#303030", "name": "Grey19"},
    "237": {"hex": "#3a3a3a", "name": "Grey23"},
    "238": {"hex": "#444444", "name": "Grey27"},
    "239": {"hex": "#4e4e4e", "name": "Grey30"},
    "240": {"hex": "#585858", "name": "Grey35"},
    "241": {"hex": "#626262", "name": "Grey39"},
    "242": {"hex": "#6c6c6c", "name": "Grey42"},
    "243": {"hex": "#767676", "name": "Grey46"},
    //"244": {"hex": "#808080", "name": "Grey50"},
    "245": {"hex": "#8a8a8a", "name": "Grey54"},
    "246": {"hex": "#949494", "name": "Grey58"},
    "247": {"hex": "#9e9e9e", "name": "Grey62"},
    "248": {"hex": "#a8a8a8", "name": "Grey66"},
    "249": {"hex": "#b2b2b2", "name": "Grey70"},
    "250": {"hex": "#bcbcbc", "name": "Grey74"},
    "251": {"hex": "#c6c6c6", "name": "Grey78"},
    "252": {"hex": "#d0d0d0", "name": "Grey82"},
    "253": {"hex": "#dadada", "name": "Grey85"},
    "254": {"hex": "#e4e4e4", "name": "Grey89"},
    "255": {"hex": "#eeeeee", "name": "Grey93"}
}

function colorIdToHex(colorId) {
    return xtermColors[colorId.toString()].hex;
}

function colorIdToXtermName(colorId) {
    return xtermColors[colorId.toString()].name;
}

function tokenIdFromHex(hex) {
    let colorEntry = Object.entries(xtermColors).filter(entry => entry[1].hex === hex.toLowerCase());
    return colorEntry.length === 0 ? -1 : parseInt(colorEntry[0][0]);
}

function hexToXtermName(hex) {
    let colorEntry = Object.entries(xtermColors).filter(entry => entry[1].hex === hex.toLowerCase());
    return colorEntry.length === 0 ? '' : colorEntry[0][1].name;
}


module.exports = {
    isNumeric,
    colorIdToHex,
    colorIdToXtermName,
    tokenIdFromHex,
    hexToXtermName
}